<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Quiz Robinson Crusoe</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    h1 { color: #2c3e50; }
    .domanda { margin-bottom: 20px; padding: 15px; border: 1px solid #ccc; border-radius: 8px; }
    .domanda p { font-weight: bold; }
    .opzione { margin: 4px 0; }
    textarea { width: 100%; height: 100px; margin-top: 10px; }
    #invia { margin-top: 30px; padding: 10px 20px; font-size: 16px; }
    #contenutoPdf { display: none; }
  </style>
</head>
<body>
  <h1>Quiz Robinson Crusoe</h1>
  <div id="quiz"></div>
  <button id="invia">INVIA</button>

  <div id="contenutoPdf"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <script>
    const tutteDomande = [
      {
        "domanda": "What is Robinson Crusoe’s real family name?",
        "tipo": "scelta_multipla",
        "opzioni": ["Robinson", "Kreutznaer", "Crusader", "Kramer", "Kreuzberg"]
      },
      {
        "domanda": "Where was Crusoe born?",
        "tipo": "scelta_multipla",
        "opzioni": ["Bristol", "York", "London", "Edinburgh", "Bremen"]
      },
      {
        "domanda": "Describe Robinson Crusoe’s feelings upon being shipwrecked.",
        "tipo": "aperta"
      }
    ];

    function caricaDomande() {
      const quizDiv = document.getElementById('quiz');
      tutteDomande.forEach((domanda, i) => {
        const div = document.createElement('div');
        div.className = 'domanda';
        if (domanda.tipo === 'scelta_multipla') {
          div.innerHTML = `<p>${i + 1}. ${domanda.domanda}</p>` +
            domanda.opzioni.map(opt =>
              `<div class="opzione"><label><input type="radio" name="q${i}" value="${opt}"> ${opt}</label></div>`
            ).join('');
        } else if (domanda.tipo === 'aperta') {
          div.innerHTML = `<p>${i + 1}. ${domanda.domanda}</p><textarea name="q${i}"></textarea>`;
        }
        quizDiv.appendChild(div);
      });
    }

    document.getElementById('invia').addEventListener('click', async () => {
      const contenitore = document.getElementById('contenutoPdf');
      contenitore.innerHTML = "<h2>Risposte del quiz</h2>";
      contenitore.style.display = 'block';

      const domande = document.querySelectorAll('.domanda');
      domande.forEach((d, i) => {
        const testoDomanda = d.querySelector('p')?.innerText || `Domanda ${i + 1}`;
        const risposta = d.querySelector('input[type="radio"]:checked')?.value ||
                         d.querySelector('textarea')?.value?.trim() || "[Nessuna risposta]";
        contenitore.innerHTML += `<p><strong>${i + 1}. ${testoDomanda}</strong><br>Risposta: ${risposta}</p>`;
      });

      await new Promise(r => setTimeout(r, 100));

      const nomeFile = prompt("Inserisci il nome del file PDF:");
      if (nomeFile) {
        await html2pdf().from(contenitore).save(nomeFile + ".pdf");
      }

      contenitore.style.display = 'none';
    });

    caricaDomande();
  </script>
</body>
</html>
